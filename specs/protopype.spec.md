
# Назначение

Данный файл описывает спецификацию прототипа программы для управления расписанием занятости специалистов по времени и кабинетам.

Целевое состояние: система должна быть разработана как клиент-серверное приложение. Пользовательский интерфейс работает в браузере мобильного телефона используя JavaScript + CSS + HTML. Серверная сторона .NET Core 10. СУБД PostgreSQL. Развертывание в Linux/Docker.
При многопользовательской работе изменения в расписании одним пользователем должны синхронизироваться у другого пользователя (WebSocket). Нагрузка на систему мизерная: 10 запросов в час, клиентов до 100, специалистов до 25, одновременных пользователей до 10.

Целевое состояние прототипа: отработать механику работы пользователя в интерфейсе браузера мобильного телефона. Все параметры для работы: клиенты, специалисты и т.д. должны загружаться через JSON-файл и все изменения хранятся в браузере без серверной части. Смысл — показать в механике как это всё будет «тыкаться». Авторизация в прототипе не предполагается.
Прототип должен быть разработан на JavaScript, CSS, HTML. CSS должен быть в отдельном файле, JavaScript тоже. Конфиг должен загружаться при старте приложения. Объект с данными сохраняется в локальном хранилище браузера и выдерживает обновление страницы.

Минимальная поддерживаемая ширина экрана — 360px.

Всем DOM-элементам присваивать ID для удобства ссылок и коммуникации.


# Сущности

В системе участвуют следующие сущности:

- Специалист
  - id (UUID)
  - название
- Клиент
  - id (UUID)
  - название
- Кабинет
  - id (UUID)
  - название
- Резерв
  - id (UUID, генерируется автоматически)
  - id кабинета
  - id клиента
  - id специалиста
  - дата
  - временной интервал

Специалист и клиент с именем «-» обозначают «свободно» и имеют id = `00000000-0000-0000-0000-000000000000` (Guid.Empty).

## Конфигурация

Файл: `cctime.config.json`

```json
{
    "specialists": [
        { "id": "00000000-0000-0000-0000-000000000000", "name": "-" },
        { "id": "a1b2c3d4-0001-0000-0000-000000000001", "name": "Специалист1" },
        { "id": "a1b2c3d4-0001-0000-0000-000000000002", "name": "Специалист2" }
    ],
    "clients": [
        { "id": "00000000-0000-0000-0000-000000000000", "name": "-" },
        { "id": "b2c3d4e5-0002-0000-0000-000000000001", "name": "Клиент1" }
    ],
    "rooms": [
        { "id": "c3d4e5f6-0003-0000-0000-000000000001", "name": "ЛОГО" },
        { "id": "c3d4e5f6-0003-0000-0000-000000000002", "name": "НЕЙРО" }
    ],
    "timeSlots": [
        { "time": "8.30-9.15", "type": "work" },
        { "time": "9.15-10.00", "type": "work" },
        { "time": "10.00-10.45", "type": "work" },
        { "time": "перерыв 15 мин", "type": "break" },
        { "time": "11.00-11.45", "type": "work" },
        { "time": "11.45-12.30", "type": "work" },
        { "time": "12.30-13.15", "type": "work" },
        { "time": "обед", "type": "break" },
        { "time": "13.30-14.15", "type": "work" },
        { "time": "14.15-15.00", "type": "work" },
        { "time": "15.00-15.45", "type": "work" },
        { "time": "перерыв 15 мин", "type": "break" },
        { "time": "16.00-16.45", "type": "work" },
        { "time": "16.45-17.30", "type": "work" },
        { "time": "17.30-18.15", "type": "work" },
        { "time": "перерыв 15 мин", "type": "break" },
        { "time": "18.30-19.15", "type": "work" },
        { "time": "19.15-20.00", "type": "work" }
    ]
}
```

## Структура данных резервов

Хранится в localStorage браузера.

```json
{
    "cctime.reserves": [
        {
            "id": "UUID",
            "date": "YYYY-MM-DD",
            "timeSlot": "8.30-9.15",
            "roomId": "UUID",
            "clientId": "UUID",
            "clientConfirm": false,
            "specialistId": "UUID",
            "specialistConfirm": false
        }
    ]
}
```


# Пользовательский интерфейс

## Основные положения

Интерфейс должен быть адаптирован для работы в браузере телефона и работе пальцами. Минимальная ширина — 360px. Стиль — приятный, аккуратный.

## Страницы

### Страница расписания на день

Структура:
- шапка
- рабочая область
- подвал

#### Шапка

Состоит из трёх частей:
- левая — кнопка «назад» (предыдущий день)
- средняя — пустая (зарезервировано под логотип)
- правая — кнопка «вперёд» (следующий день)

Навигация по дням бесконечна в обе стороны.

#### Рабочая область

Состоит из колонок:
- колонка времени
- заголовок: дата в формате {дд.мм.гггг} + {название дня недели}
    - колонка кабинета 1
    - колонка кабинета 2

Строками являются временные интервалы, загружаемые из конфигурации (`timeSlots`).

Строки с типом `break` (перерывы, обед) отображаются как визуальные разделители с цветовым выделением. Резервирование для перерывов недоступно.

В пересечении кабинета и рабочего интервала времени выводятся сведения о резерве:
- первая строка — специалист, указанный в резерве
- вторая строка — клиент, указанный в резерве

Поведение:
- При клике на область резерва открывается страница редактирования (или создания, если резерва нет).
- При свайпе вверх/вниз скроллится только рабочая область.

#### Прошлые даты

Резервы в прошлом (ранее текущей даты) выделяются цветом. При открытии страницы редактирования кнопка «сохранить» отсутствует.

### Страница создания/редактирования резерва

Может быть выполнена как popup или как самостоятельная страница. Доступные элементы:

- выбор специалиста (выпадающий список)
- количество резервов специалиста (целое положительное число) — сколько будущих недель тиражировать этого специалиста в данном кабинете, в этот день недели, в это время
- галочка «подтверждено» для специалиста
- выбор клиента (выпадающий список)
- количество резервов клиента (целое положительное число) — сколько будущих недель тиражировать этого клиента в данном кабинете, в этот день недели, в это время
- галочка «подтверждено» для клиента

При создании и при редактировании количество резервов по умолчанию заполняется значением 1. Пользователь может изменить.

Кнопки управления:
- сохранить (отсутствует для резервов в прошлом)
- отменить

#### Логика сохранения

При сохранении обновляется текущий резерв и выполняется тиражирование на будущие недели.

**Тиражирование специалиста и клиента обрабатывается независимо:**
- Если для специалиста указано количество N, создаются (или обновляются) резервы на N следующих недель (тот же день недели, то же время, тот же кабинет) с этим специалистом.
- Если для клиента указано количество M, создаются (или обновляются) резервы на M следующих недель с этим клиентом.
- Если N ≠ M, то в неделях где тиражируется только один параметр, второй остаётся без изменений (или «свободно» для новых резервов).

**Проверка конфликтов при тиражировании:**
- Если в будущем резерве уже указан **другой** специалист (не совпадает с тиражируемым и не «свободно»), выводится предупреждение и сохранение не выполняется. Пользователь должен изменить количество на 1, чтобы сохранить только текущий резерв.
- Аналогично для клиента.
- Если в будущем резерве уже стоит **тот же** специалист/клиент — конфликта нет.

**Подтверждения:**
- Параметры подтверждения (`clientConfirm`, `specialistConfirm`) в будущих тиражированных резервах всегда устанавливаются в `false`.
- Подтверждения никогда не тиражируются.

**Удаление:**
Операции удаления нет. Для очистки резерва пользователь выбирает специалиста/клиента «-» (Guid.Empty), что означает «свободно».
